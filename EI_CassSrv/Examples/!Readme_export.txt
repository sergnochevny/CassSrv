===========================Библиотка ExpImp_Dukat.dll===========================

ЭКСПОРТ/ИМПОРТ ДАННЫХ О ТОВАРАХ В/ИЗ БАЗУ КАССОВОГО СЕРВЕРА. 

(С возможностью делений на отделы.)
--------------------------------------------------------------------------------
	1. Технические требования.
	2. Описание библиотеки.
		2.1. Описание функций.
		2.2. Описание файла настроек.
		2.3. Формат промежуточного файла.
	3. Примеры подключения библиотеки.
--------------------------------------------

======= 1. Технические требования.

	Для настройки экспорта необходимы следующии элементы:
    	1. Database version 135(минимум).
    	2. Butuz version 3.60.08(минимум).
    	3. Пакет программы кассового сервера "Дукат" 
         с реализацией привязки касс и цен к отделам (вариант ЗАТ "Новинка").
    	4. Дополнительные таблицы для библиотеки.
    	5. BServer.exe version 2.55.01(минимум).
    	6. ExpImp_Dukat.dll version 2.0.01(минимум).
    	7. EIDukat.ini - файл настроек (см. п. 2.3.).
    	8. Настройка связи, справочников и подключение отчета (см. п. 3.1.).
--------------------------------------------

======= 2. Описание библиотеки.

	ВАЖНО!!! Библиотека должна находится в каталоге, где размещены BTAdmin.exe и/или Butuz.exe
	
	Функции, подключаемые в сиситеме Бу-Туз:
    				InitLibrary,
    				SyncData,
    				ExportData,
    				ImportData

 	Имеют формат: function ^^^^^^^^^^ (Value: OleVariant): Olevariant; stdcall;
 	Вызываются внутренней функцией GetDllStr(<DllName>,<FunctinName>,<ParametersStringfordllfunction>). GetDllStr возвращает результат
 	вызываемой функции.
  	Параметры для функций формируются в строку с разделителем ";". Эта строка - третий (последний) параметр для функции GetDllStr.
  	Для работы функций необходимо наличие:
  		а)	базы кассового сервера и дополнительных таблиц. Дополнительные таблицы должны находится
  			в каталоге базы кассового сервера;
  		б)	файла настроек EIDukat.ini.
  	
	2.1. Описание функций.
	----------------------
	
		а) InitLibrary (Инициализация библиотеки)
		==================
			Возвращает '0' либо '1' (значения не функциональны). Вызов обязателен (единожды) перед вызовом иных функций.
		
			Параметры:
				1. Хендл вызывающей программы. (в сиситеме бутуз таковой возвращает эвалуаторная функция AppHandle).
			
		б) SyncData (Выполняет синхронизацию данных в базах системы и кассового сервера - только коды, штрих-коды и наименования.
					 Данные берутся из внешнего файла, сформированного системой.)
		==================
			Возвращает строку в виде 'str1;str2',
			где:
				str1 - количество позиций синхронизированного товара (-3, 0..n);
					('-3' : Путь к базе кассового сервера задан неверно. (см. п. 2.2))
				str2 - количество строк переданного для синхронизации (0..n).
			
			Параметры: Пустая строка.
		
		в) ExportDatа	(Выполняет закачку информации по товарам в базу кассового сервера. Заносит новый товар, увеличивает остаток для
						 существующего там товара и изменяет его цену на новую, загружает штрих-коды при наличии.
						 Данные берутся из внешнего файла, сформированного системой)
		==================
			Возвращает строку в виде 'str1;str2',
			где:
				str1 - количество позиций синхронизированного товара (-3, 0..n);
					('-3' : Путь к базе кассового сервера задан неверно. (см. п. 2.2))
				str2 - количество строк переданного для синхронизации (0..n).
			
			Параметры: Пустая строка.
			
		г) ImportData (Выполняет формирование файла определенного формата, куда складывает информацию о продажах с базы кассового сервера,
					   которые соответсвуют входным параметрам.
					   При повторном использовании функции данные предыдущей обработки не исключаются.)
		==================
			Возвращает строку 'str'
				'-3'		: Путь к базе кассового сервера задан неверно. (см. п. 2.2)	
				'-2'		: Не удается создать выходной файл.		
				'-1'		: есть несинхронизированный с основной базой товар.
				'0'			: Данных нет
				'n'(n > 0)	: Количество обработанных записей.
				
			Параметры:
				1. Отдел (если есть, иначе путая строка)
				(Составляющие даты, за которую желаем получить реализацию.)
				2. Год
				3. Месяц
				4. День
        5. Вид оплаты (0-наличные, 1-чек, 2-кредит )

		ВАЖНО!!! Для работы библиотеки необходим файл настроек.

				
	2.2. Описание файла настроек.
	----------------------------
	
		ВАЖНО!!! Файл настроек должен находится рядом с BTAdmin.exe и/или Butuz.exe

		Файл настроек EIDukat.ini содержит три секции:

			begin=============================EIDukat.ini
			
			[COMMON]
			PathBasa = D:\DUKAT\DATA

			[FILES]
			ImpFileName = Imp.dat
			ExpFileName = Exp.dat
			SyncFileName = Sync.dat
			ScriptFile = imp.sql

			[TOKENS]
			TokenLog = 1
			TokenWriteWOSync = 0		
			
			end===============================EIDukat.ini
		
			PathBasa - путь к базе касового аппарата;
			ImpFileName - наименование файла экспорта;
			ExpFileName - наименование файла импорта;
			SyncFileName - наименование файла синхронизации;
			ScriptFile - наименование файла скрипта;
			TokenLog - признак ведения лог-файла;
				Значения (0, 1, 2):
					0 - не вести лог-файл;
					1 - вести лог-файл 'EIDukat.log' (файл на диск пишется автоматически в директорий с Butuz.exe/BTAdmin.exe);
					2 - выводить окно с содержимым лог-файла (файл на диск пишется по желанию).
			TokenWriteWOSync - признак формирования файла импорта при наличии несинхронизированного товара;
				Значения (0, 1):
					0 - не создавать файл импорта данных при рассинхронизации;
					1 - создавать файл импорта в любом случае.
					
	2.2. Форматы промежуточных файлов.
	----------------------------------
		
		ExpHeader - 'TCE';
		ImpHeader - 'TCI';
		US - Chr(31)
		RS - Chr(30)
		FS - Chr(28)
		GS - Chr(29)
		
		Экспорт:
		------------------------------------------	

			Header:
			|	Record:
			|	|	ExpHeader+Us+
			|	|	Field1+Us+
			|	|	Field2+Us+
			|	|	Field3+Us+
			|	Rs+
			Gs+
			Body:
			|	Record:		
			|	|	IncrMtu+Us+
			|	|	Code+Us+
			|	|	Name+Us+
			|	|	ShortName+Us+
			|	|	BarCode+Us+
      | | Department+Us+
			|	|	TaxGrp+Us+
			|	|	Price+Us+
			|	|	Count+Us+
			|	|	Dividable+Us+
			|	|	ValidCount+Us+
			|	|	IncrEd+Us+
			|	|	Fs+ (if any)
			|	|	|	BarCode1+Us+ (from MtuBar)
			|	|	|	Scale1+Us+
			|	|	|	BarCode2+Us+
			|	|	|	Scale2+Us+
			|	|	|	BarCode3+Us+
			|	|	|	Scale3+Us+
			|	|	|	...
			|	|	|	BarCodeN+Us+
			|	|	|	ScaleN
			|	|	Us+
			|	Rs+
			Gs

		Синхронизация:
		------------------------------------------

			Header:
			|	Record:
			|	|	ExpHeader+Us+
			|	|	Field1+Us+
			|	|	Field2+Us+
			|	|	Field3+Us+
			|	Rs+
			Gs+
			Body:
			|	Record:		
			|	|	IncrMtu+Us+
			|	|	Code+Us+
			|	|	Name+Us+
			|	|	ShortName+Us+
			|	|	BarCode+Us+
			|	|	IncrEd+Us+
			|	|	Fs+ (if any)
			|	|	|	BarCode1+Us+ (from MtuBar)
			|	|	|	Scale1+Us+
			|	|	|	BarCode2+Us+
			|	|	|	Scale2+Us+
			|	|	|	BarCode3+Us+
			|	|	|	Scale3+Us+
			|	|	|	...
			|	|	|	BarCodeN+Us+
			|	|	|	ScaleN
			|	|	Us+
			|	Rs+
			Gs
			
		Импорт:
		------------------------------------------		

			Header:
			|	Record:
			|	|	ImpHeader+Us+
			|	|	Year+Us+
			|	|	Month+Us+
			|	|	Day+Us+
			|	Rs+
			Gs+
			Body:
			|	Record:		
			|	|	Department+Us+
			|	|	IncrMtu+Us+
			|	|	Price+Us+
			|	|	Count+Us+
			|	|	Summa+Us+
			|	|	TaxSum+Us+
			|	|	Discount+Us+
			|	|	IncrEd+Us+
			|	Rs+
			Gs

		ВАЖНО!!! Соблюдение форматов!!!
--------------------------------------------			

======= 3. Пример подключения библиотеки.
  Смотрите макеты отчетов: EXPORT_D.QR2, EXPORT_D_IM.QR2, EXPORT_D_PR.QR2
  макеты документов: Акт_Реализация_через_ЭККА.ds, Акт_Реализация_через_ЭККА_(visa).ds 
			